!function(t){if("undefined"==typeof wc_price_based_country_ajax_geo_params)return;var a={xhr:!1,get_product_ids:function(){var c=[],e=null;return t("span.wcpbc-price.loading").each(function(){if(void 0===(e=t(this).data("productId"))){var r=t(this).attr("class").match(/wcpbc-price-\d+/);null!=r&&0<r.length&&(e=parseInt(r[0].replace("wcpbc-price-","")))}e&&void 0!==e&&c.push(e)}),0<t("form.variations_form").length&&t("form.variations_form").each(function(){var r=t(this).data("product_variations");null!=r&&t.each(r,function(r,e){void 0!==e.variation_id&&c.push(e.variation_id)})}),t(document.body).trigger("wc_price_based_country_get_product_ids",[c]),c.sort(),c},get_areas:function(){var o={};return t(".wc-price-based-country-refresh-area:not(.refreshed)").each(function(r,e){var c=t(e).data("area"),a=t(e).data("id"),i=t(e).data("options");void 0!==c&&void 0!==a&&void 0!==i&&(void 0===o[c]&&(o[c]={}),o[c][a]=i)}),o},refresh_product_price:function(i){var c;t.each(i,function(r,e){void 0!==(c=t("<div>"+e.price_html+"</div>").find(".wcpbc-price.wcpbc-price-"+e.id+":first"))&&t(".wcpbc-price.wcpbc-price-"+e.id).html(c.html()).removeClass("loading")}),0<t("form.variations_form").length&&t("form.variations_form").each(function(){var a=t(this).data("product_variations");null!=a&&(t.each(a,function(r,e){var c=t(e.price_html);void 0!==i[e.variation_id]&&(a[r].display_price=i[e.variation_id].display_price,a[r].display_regular_price=i[e.variation_id].display_regular_price,c.hasClass("price")?c.first().html(i[e.variation_id].price_html):c.html(i[e.variation_id].price_html)),c.find(".wcpbc-price").css("visibility",""),c.find(".wcpbc-price").removeClass("loading"),a[r].price_html=c.html()}),t(this).data("product_variations",a))}),t(document.body).trigger("wc_price_based_country_set_product_price",[i]),t(".wcpbc-price").css("visibility",""),t(".wcpbc-price").css("display",""),t(".wcpbc-price").removeClass("loading")},refresh_areas:function(r){t.each(r,function(r,e){var c='.wc-price-based-country-refresh-area[data-id="'+e.id+'"][data-area="'+e.area+'"]',a=t(e.content).filter('.wc-price-based-country-refresh-area[data-area="'+e.area+'"]').html();t(c).html(a).addClass("refreshed")})},refresh_currency_settings:function(r){if("undefined"!=typeof woocommerce_price_slider_params&&"undefined"!=typeof accounting){var e=t(".price_slider_amount #min_price").data("min"),c=t(".price_slider_amount #max_price").data("max");t(".price_slider_amount span.from").html(accounting.formatMoney(e,{symbol:r.symbol,decimal:r.decimal_sep,thousand:r.thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:r.format})),t(".price_slider_amount span.to").html(accounting.formatMoney(c,{symbol:r.symbol,decimal:r.decimal_sep,thousand:r.thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:r.format})),woocommerce_price_slider_params.currency_format_symbol=r.symbol,woocommerce_price_slider_params.currency_format_decimal_sep=r.decimal_sep,woocommerce_price_slider_params.currency_format_thousand_sep=r.thousand_sep,woocommerce_price_slider_params.currency_format=r.format}t(document.body).trigger("wc_price_based_country_set_currency_params",[r])},geolocate_customer:function(){a.xhr&&a.xhr.abort();var r={ids:a.get_product_ids(),areas:a.get_areas(),is_single:t("body").hasClass("single")?"1":"0"};0===r.ids.length&&t.isEmptyObject(r.areas)||(a.xhr=t.ajax({url:wc_price_based_country_ajax_geo_params.wc_ajax_url.toString().replace("%%endpoint%%","wcpbc_get_location"),data:r,type:"POST",success:function(r){a.refresh_product_price(r.products),a.refresh_areas(r.areas),a.refresh_currency_settings(r.currency_params),t(document.body).trigger("wc_price_based_country_after_ajax_geolocation",[r.zone_id])},error:function(){t(".wcpbc-price").css("visibility",""),t(".wcpbc-price").css("display",""),t(".wcpbc-price").removeClass("loading")},complete:function(){a.xhr=!1}}))},init:function(){this.geolocate_customer(),t(document).ajaxComplete(function(r,e,c){0==t("body").find(".wcpbc-price.loading").length||0<c.url.indexOf("wcpbc_get_location")||0<c.url.indexOf("get_refreshed_fragments")||void 0!==e.responseText&&0<e.responseText.indexOf("wcpbc-price")&&a.geolocate_customer()}),t(document.body).on("wc_price_based_country_ajax_geolocation",a.geolocate_customer)}};a.init()}(jQuery);